<!DOCTYPE html>
<html class="application">
  <head>
    <title>Campanify</title>
  	<%= csrf_meta_tags %>
		<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  	<%= stylesheet_link_tag    "application", :media => "all" %>
		
  </head>
  <body>
	
		<div class="container-fluid">
		  <div class="page row-fluid">
		    <div class="sidebar span3">
		      <%= render "shared/sidebar" %>
		    </div>
		    <div class="main span9">
		      <%= yield %>
		    </div>
		  </div>
		</div>
		
		<%= render "shared/campaigns_template" %>
  	<%= javascript_include_tag "application" %>
		<script src="http://js.pusher.com/1.12/pusher.min.js"></script>
		<script>
		 Pusher.log = function(message) {
          if (window.console && window.console.log) window.console.log(message);
      };
  
      WEB_SOCKET_DEBUG = true;
		var pusher = new Pusher('<%= ENV['PUSHER_API_KEY']%>'); // Replace with your app key
		var channel = pusher.subscribe('campaigns');
		channel.bind('update', function(data) {
			var campaigns_tr = $("#campaigns_template_tr").html();
			campaigns_tr = campaigns_tr.
							replace(/\${slug}/g, data.slug).
							replace(/\${name}/g, data.name).
							replace(/\${plan}/g, data.plan).
							replace(/\${status}/g, data.status).
							replace(/\${price}/g, data.price).								
							replace(/\${theme}/g, data.theme).																	
							replace(/\${id}/g, data.id);
		  $("tr#campaign_" + data.id).replaceWith(campaigns_tr);
			var tr = $("tr#campaign_" + data.id);
			if (tr.find(".status").text() != "online") tr.find(".actions").html('<%= image_tag "ajax-loader.gif" %>');
			tr.find(".change_campaign_plan").val(tr.find(".plan").data("plan"));
			tr.find(".change_campaign_theme").val(tr.find(".theme").data("theme"));		
		});
		</script>
  </body>
</html>